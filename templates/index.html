<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATP Rankings Database</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/theme.css') }}">
    <style>
        .hero-card {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background: linear-gradient(140deg, rgba(37, 99, 235, 0.1), rgba(14, 165, 233, 0.08)), var(--color-surface);
            position: relative;
            overflow: hidden;
        }

        .hero-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.6), transparent 45%);
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-actions {
            position: relative;
            z-index: 1;
        }

        .hero-stats {
            position: relative;
            z-index: 1;
        }

        .hero-stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: var(--shadow-soft);
        }

        .hero-stat-card strong {
            display: block;
            font-size: 2rem;
            color: var(--color-primary);
        }

        .hero-stat-card span {
            color: var(--color-muted);
            font-size: 0.95rem;
        }

        .search-stack {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .info-callout {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            background: var(--color-surface-soft);
            border-radius: var(--radius-lg);
            padding: 1rem 1.25rem;
            border-left: 4px solid var(--color-primary);
            color: var(--color-muted);
            font-size: 0.95rem;
        }

        .info-callout strong {
            color: var(--color-text);
        }

        .week-grid {
            max-height: 340px;
            overflow-y: auto;
        }

        .stat-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            color: var(--color-muted);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .hero-stat-card strong {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-shell">
        <section class="surface-card hero-card">
            <div class="hero-content">
                <div class="chip">Historic ATP archive</div>
                <div class="section-heading">
                    <h1>Explore every ATP ranking week since 1973</h1>
                    <p>Search 2,600+ Mondays of tennis history, compare players, and plug the data into your own tools or AI agents.</p>
                </div>
            </div>
            <div class="hero-actions button-row">
                <a href="/api-docs" class="btn btn--primary">üìò API documentation</a>
                <a href="/api/weeks" class="btn btn--secondary" target="_blank">üîå View raw weeks JSON</a>
                <a href="/compare" class="btn">üë• Player comparison</a>
                <a href="/weeks-at-no1" class="btn btn--ghost">üèÜ Weeks at #1</a>
                <a href="/mcp/health" class="btn btn--success" target="_blank">ü§ñ MCP Server</a>
            </div>
            <div class="hero-stats stat-grid">
                <div class="hero-stat-card">
                    <strong>{{ total_weeks }}</strong>
                    <span>Total ranking weeks captured</span>
                </div>
                <div class="hero-stat-card">
                    <strong>{{ weeks_by_year.keys()|list|min }} ‚Äì {{ weeks_by_year.keys()|list|max }}</strong>
                    <span>Complete coverage span</span>
                </div>
                <div class="hero-stat-card">
                    <strong>Instant</strong>
                    <span>No auth or rate limits</span>
                </div>
            </div>
        </section>

        <section class="surface-card" style="margin-top: 2.5rem;">
            <div class="section-heading">
                <h2>Browse weekly rankings</h2>
                <p>Search for a Monday or expand a year to jump straight into any ranking snapshot.</p>
            </div>
            <div class="search-stack">
                <label class="input-control" for="searchInput">
                    <input type="text" id="searchInput" class="search-input" placeholder="Try 2010-01-04, 1995-06-12, etc." aria-label="Search weeks">
                </label>
                <div class="info-callout">
                    <strong>Tip:</strong>
                    <span>Start typing to filter both years and weeks instantly. Matching sections stay expanded so you can open them without extra clicks.</span>
                </div>
            </div>

            <div id="weeksContainer" style="margin-top: 1.5rem;">
                {% for year in weeks_by_year.keys()|sort(reverse=True) %}
                <div class="year-panel" data-year="{{ year }}">
                    <div class="year-panel__header" onclick="toggleYear('{{ year }}')">
                        <span>{{ year }}</span>
                        <span class="collapse-icon">‚ñæ</span>
                    </div>
                    <div class="year-panel__body">
                        <div class="week-grid" id="weeks-{{ year }}">
                            {% for week in weeks_by_year[year]|sort(reverse=True) %}
                            <a href="/week/{{ week }}" class="week-chip" data-week="{{ week }}">
                                {{ week }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
    </div>
    
    <script>
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const yearPanels = document.querySelectorAll('.year-panel');

        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                // Show all sections
                yearPanels.forEach(panel => {
                    panel.style.display = 'block';
                    const weekLinks = panel.querySelectorAll('.week-chip');
                    weekLinks.forEach(link => link.style.display = 'flex');
                    const grid = panel.querySelector('.week-grid');
                    grid.classList.add('is-hidden');
                    panel.querySelector('.year-panel__header').classList.add('is-collapsed');
                });
                return;
            }
            
            yearPanels.forEach(panel => {
                const weekLinks = panel.querySelectorAll('.week-chip');
                let hasVisibleWeeks = false;
                
                weekLinks.forEach(link => {
                    const weekDate = link.getAttribute('data-week');
                    if (weekDate.toLowerCase().includes(searchTerm)) {
                        link.style.display = 'flex';
                        hasVisibleWeeks = true;
                    } else {
                        link.style.display = 'none';
                    }
                });
                
                // Show/hide year section based on whether it has visible weeks
                panel.style.display = hasVisibleWeeks ? 'block' : 'none';
                
                // Expand sections with results
                if (hasVisibleWeeks) {
                    const weeksGrid = panel.querySelector('.week-grid');
                    const yearHeader = panel.querySelector('.year-panel__header');
                    weeksGrid.classList.remove('is-hidden');
                    yearHeader.classList.remove('is-collapsed');
                }
            });
        });
        
        // Toggle year sections
        function toggleYear(year) {
            const panel = document.querySelector(`[data-year="${year}"]`);
            const weeksGrid = panel.querySelector('.week-grid');
            const yearHeader = panel.querySelector('.year-panel__header');
            weeksGrid.classList.toggle('is-hidden');
            yearHeader.classList.toggle('is-collapsed');
        }
        
        // Collapse all years by default except the most recent
        document.addEventListener('DOMContentLoaded', function() {
            const panels = document.querySelectorAll('.year-panel');
            panels.forEach((panel, index) => {
                const weeksGrid = panel.querySelector('.week-grid');
                const yearHeader = panel.querySelector('.year-panel__header');
                if (index === 0) {
                    weeksGrid.classList.remove('is-hidden');
                    yearHeader.classList.remove('is-collapsed');
                } else {
                    weeksGrid.classList.add('is-hidden');
                    yearHeader.classList.add('is-collapsed');
                }
            });
        });
    </script>
</body>
</html>
